var Animator=function(){"use strict";function e(e){if(!n(e))throw new G("Invalid throws structure.");const s=e.map(e=>e.map(()=>0));for(let n=0;n<e.length;n++){const t=e[n];for(const a of t)for(const t of a)s[n][t.handFrom]++,s[(n+t.value)%e.length][t.handTo]--}if(s.some(e=>e.some(e=>0!==e)))throw new G("Invalid siteswap.")}function n(e){if(!Array.isArray(e)||!e.length)return!1;for(const n of e){if(!Array.isArray(n)||n.length!==e[0].length)return!1;if(n.some(e=>!Array.isArray(e)||!e.every(({value:e,handFrom:s,handTo:t})=>void 0!==e&&void 0!==s&&void 0!==t&&s<n.length&&t<n.length)))return!1}return!0}function s(e,n){if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++){const t=e[s];const a=n[s];if(t.length!==a.length)return!1;for(let e=0;e<t.length;e++){const n=t[e];const s=a[e];if(n.length!==s.length)return!1;for(let e=0;e<n.length;e++){const t=n[e];const a=s[e];if(t.value!==a.value||t.handFrom!==a.handFrom||t.handTo!==a.handTo)return!1}}}return!0}function t(e){for(let t=1,a=ne(e.length/2);t<=a;t++)if(0==e.length%t){const n=e.slice(0,t);for(let a=t;a<e.length;a+=t){const o=e.slice(a,a+t);if(!s(n,o))break;if(t+a===e.length)return e.length=t,e}}return e}function a(e){const n=[];for(let s=0;s<e.degree;s++)n.push(Array(e.greatestValue).fill(0));if(0===e.greatestValue)return new B(n);const s=e.throws;let t=0;for(let a=-1;;a--){const o=s[(a%s.length+s.length)%s.length];for(const s of o)for(const o of s){const s=a+o.value;if(!(0>s)&&(n[o.handTo][s]++,t++,t===e.props)){let s=e.greatestValue;for(;n.every(e=>0===e[s-1]);)s--;for(let t=0;t<e.degree;t++)n[t].length=s;return new B(n)}}}}function o(e){const n=[];const s=a(e);let t=s;do for(const s of e.throws)n.push(t.schedule),t=t.advance(s);while(s!==t);return n}function r(e){const n=[];const s=i(e.states[0]);let t=s;do for(const s of e.throws)n.push(t),t=l(t,s);while(!p(s,t));return n}function i(e){let n=0;return e.map(e=>e.map(e=>Array(e).fill().map(()=>++n)))}function l(e,n){const s=e.map(e=>e.slice(1).map(e=>[...e]));for(let t=0;t<n.length;t++){const a=n[t];if(a.length||!a.every(({value:e,handTo:n,handFrom:s})=>0===e&&n===t&&s===t))for(let n=0;n<a.length;n++){const t=a[n];if(0>=t.value)continue;const o=e[t.handFrom][0][n];for(let n=0;n<s.length;n++)for(let a=e[0].length-1;a<t.value;a++)s[n][a]||(s[n][a]=[]);s[t.handTo][t.value-1].push(o)}}return s}function p(e,n){if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++){const t=e[s];const a=n[s];if(t.length!==a.length)return!1;for(let e=0;e<t.length;e++){const n=t[e];const s=a[e];if(n.length!==s.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==s[e])return!1}}return!0}function d(e,n,s,t,a){const o=s[t][a];for(const r of o){if(0===r.value)continue;const a=(t+r.value)%s.length;n[a][r.handTo]===e||(n[a][r.handTo]=e,d(e,n,s,a,r.handTo))}}function h(e){const{throws:n,notation:s}=e;const t=[];const a=n.map(e=>e.map(()=>null));for(let s=0;s<n.length;s++){const e=n[s];for(let o=0;o<e.length;o++){const r=e[o];if(null===a[s][o]&&(1!==r.length||0!==r[0].value)){const e=[];d(e,a,n,s,o),t.push(e)}}}if(1===t.length)return[e];for(let s=0;s<n.length;s++){const e=n[s];for(const n of t)n.push(e.map((e,t)=>a[s][t]===n?e:[{value:0,handFrom:t,handTo:t}]))}return t.map(e=>new Siteswap(e,s))}function u(e){const n=[];const s=[...e.throws];const t=[...e.states];const a=e.notation;let o=0;for(let r=1;r<=t.length;r++)for(let i=r-1;i>=o;i--)if(t[r%t.length]===t[i]){if(0==i&&r===t.length)return n.length?(m(n,new Siteswap(s.slice(i,r),a)),n):[e];o==i?(m(n,new Siteswap(s.slice(i,r),a)),o=r):(m(n,new Siteswap(s.splice(i,r-i),a)),t.splice(i,r-i),r=o);break}return n}function m(e,n){e.every(e=>!e.equals(n))&&e.push(n)}function g(e){return"A".repeat(ne(e/26))+z(65+e%26)}function c(e){let n=0;for(;"A"===e[n];)n++;return n<e.length-1?null:n===e.length?26*(n-1):26*n+e[n].charCodeAt(0)-65}function y([,e]){return e}function f(e){return+e}function v(e){return"a">e?e.charCodeAt(0)-65+36:e.charCodeAt(0)-97+10}function b(e,n){const s=ee(e,n);const t=K(e,n);let a=s;for(;0!=a%t;)a+=s;return a}function x(e){return e.concat(e.map(e=>e.map(e=>[...e]).reverse()))}function w(e){for(const n of e)for(const e of n)for(let n=0;n<e.length;n++)e[n]={value:e[n],handFrom:0,handTo:0};return e}function T(e){for(const n of e)for(let e=0;e<n.length;e++){const s=n[e];for(let n=0;n<s.length;n++){const{value:t,cross:a}=s[n];s[n]={value:t/2,handFrom:e,handTo:a?1-e:e}}}return e}function j(e){const n=e.map(({length:e})=>e).reduce(b);const s=[];for(let t=0;t<n;t++){const n=e.map(e=>e[t%e.length]).map(function(e,n){return e.map(function({value:e,hand:s,offset:t}){const a=void 0===t?s:n+t;return{value:e,handFrom:n,handTo:a}})});s.push(n)}return s}function k(e){const n=e.map(({length:e})=>e).reduce(b);const s=[];for(let t=0;t<n;t++){const n=e.map(e=>e[t%e.length][0]).map(function(e,n){return e.map(function({value:e,pass:s}){!0===s&&(s=2-n);const t=null===s?n:s-1;return{value:e,handFrom:n,handTo:t}})});s.push(n)}return s}function _(e){const n=e.map(({length:e})=>e).reduce(b);const s=[];for(let t=0;t<n;t++){const n=Array.prototype.concat(...e.map(e=>e[t%e.length])).map(function(e,n){return e.map(function({value:e,pass:s,cross:t}){!0===s&&(s=2-ne(n/2));const a=(null===s?n:2*(s-1)+n%2)+(t?n%2?-1:1:0);return{value:e/2,handFrom:n,handTo:a}})});s.push(n)}return s}function S(e,n=null){if(null===n){const n={};return n.immutables=[],n.terminals=new Set,e=S(e,n),e.immutables=n.immutables,e.terminals=[...n.terminals],e}if(null===e)return e;if("string"==typeof e){if(!te[e])throw new Error("Parsing error.");return S(te[e],n)}if(Array.isArray(e))return{symbols:e.map(e=>S(e,n))};if(e.fixed&&!e.value&&n.immutables.push(e),e.tokenType)return n.terminals.add(e),e;if("object"!=typeof e)throw new Error("Parsing error.");if(e.symbol)e.symbol=S(e.symbol,n);else if(e.symbols)e.symbols=e.symbols.map(e=>S(e,n));else if(e.repeat)e.repeat=e.repeat.map(e=>S(e,n));else if(e.either)e.either=e.either.map(e=>S(e,n));else if(e.allow)e.either=[S(e.allow,n),null],delete e.allow;else throw new Error("Parsing error.");return e}function F(e,n){const s=new RegExp(e.sort((e,n)=>e.index-n.index).map(({regex:e})=>`(${e})`).join("|"),"y");const t=[];for(;s.lastIndex<n.length;){const a=s.exec(n);if(null===a)return null;const o=a.findIndex((e,n)=>n&&e);t.push({type:e[o-1].tokenType,value:a[o]})}return t}function A(e){let n;if(null===e)return null;if(e.tokenType){const s=oe[re];if(!s||s.type!==e.tokenType)return ae;if(e.fixed)if(!e.value)e.value=s.value;else if(s.value!==e.value)return ae;n=s.value,re++}else if(e.symbol){if(n=A(e.symbol),n===ae)return ae;}else if(e.symbols){n=[];for(const s of e.symbols){const e=A(s);if(e===ae)return ae;n.push(e)}}else if(e.repeat){for(n=[];n.length<e.max;){const s=re;const t=A({symbols:e.repeat});if(t===ae){re=s;break}n.push(t)}if(n.length<e.min||n.length>e.max)return ae}else if(e.either){for(const n of e.either){const s=re;const t=A(n);if(t===ae){re=s;continue}const a=e.processor;if(e.fixed)if(void 0===e.value)e.value=n;else if(n!==e.value)return ae;return a?a(t):t}return ae}return e.processor?e.processor(n):n}function I(e,n){if(!e||!te[e])throw new Error("Parsing error.");"function"==typeof te[e]&&(te[e]=S(te[e]()));const s=te[e];for(const t of s.immutables)delete t.value;if(re=0,oe=F(s.terminals,n),!oe||!oe.length)return null;const t=A(s);return t===ae||re!==oe.length?null:t}function R({value:e,handFrom:n,handTo:s}){return`${2*e}${n===s?"":"x"}`}function C({value:e,handFrom:n,handTo:s}){return`${2*e}${n===s?"":"x"}`}function $(e){const n=e.map(({value:e,handFrom:n,handTo:s})=>`${e}${n===s?"":`p${s+1}`}`).join(",");return 1===e.length?n:`[${n}]`}function P(e){const n=e.map(({value:e,handFrom:n,handTo:s})=>`${2*e}${n%2==s%2?"":"x"}${s===n||s===n+(n%2?-1:1)?"":"p"+(ne(s/2)+1)}`).join(",");return 1===e.length?n:`[${n}]`}function V(e){const n=e.map(({value:e,handTo:n})=>`${g(n)}${e}`).join(",");return 1===e.length?n:`[${n}]`}function H(e,n){if(n=n.reduce((e,s)=>e.concat(Array.isArray(ie[s])?ie[s]:s),[]),"object"==typeof e){const s=n[0];if(("string"!=typeof s||!ie[s])&&null!==s)throw new G("Unsupported notation.");return{notation:s,throws:e}}if(n.some(e=>"string"!=typeof e||!ie[e]))throw new G("Unsupported notation.");for(const s of n){const n=ie[s].parse(e);if(n)return{notation:s,throws:n}}throw new G("Invalid syntax.")}function q(e){return e.every(e=>e.every((e,n,{length:s})=>1===e||0===e&&n===s-1))}function W(e,n,s){for(let t=0;t<e.length;t++){const a=(t+s)%e.length;if(e[a].length!==n[t].length)return!1;for(let s=0;s<e[a].length;s++){if(e[a][s].length!==n[t][s].length)return!1;for(let o=0;o<e[a][s].length;o++){const r=e[a][s][o];const i=n[t][s][o];if(r.value!==i.value||r.handFrom!==i.handFrom||r.handTo!==i.handTo)return!1}}}return!0}function U(e,n){return"string"!=typeof e&&(e=e.toString()),n++,e.length>=n?e:`${Array(n-e.length).join(" ")}${e}`}function N(e,n,s,t){const a=e.context;const o=a.canvas;const r=e[be];n&&s&&t&&(r.innerWidth=n,r.innerHeight=s,r.catchHeight=t),o.width=o.clientWidth,o.height=o.clientHeight,r.multiplier=ee(0,K(o.width/(r.innerWidth+2*r.ballRadius),o.height/(r.innerHeight+2*r.ballRadius)));const i={x:ee(0,o.clientWidth-(r.innerWidth+2*r.ballRadius)*r.multiplier),y:ee(0,o.clientHeight-(r.innerHeight+2*r.ballRadius)*r.multiplier)};const l={x:.5*i.x+r.ballRadius*r.multiplier,y:.5*i.y+r.ballRadius*r.multiplier};a.translate(l.x,o.height-l.y-r.catchHeight*r.multiplier),a.scale(1,-1)}function D(e,n){const s=ee(e,n);const t=K(e,n);let a=s;for(;0!=a%t;)a+=s;return a}function E(e){if(2===e.degree)return e.throws;const s=[];const t=D(e.throws.length,2);for(let n=0;n<t;n++){const t=[[],[]];const a=e.throws[n%e.throws.length][0].map(e=>({value:e.value,handFrom:n%2,handTo:(n+e.value)%2}));t[n%2]=a,s.push(t)}return s}function O(e,n,s){return ee(n,K(s,e))}function M(e){var s=Math.abs;const t=e.siteswap;const a=e[xe];const o=Array(t.props).fill().map(()=>new ue(a.ballColor));e[we]=o;const r=a.beatDuration*t.degree;let i=0;let l=0;const p=350-200*s(.5-a.dwell)+15*(t.greatestValue-3);const d=500+p;const h=3-t.degree;const u=.1*h;const m=ee(u,K(.9*h,a.dwell*h));const g=E(t);const c=D(g.length,t.strictStates.length);for(let n=0;n<c;n++){const e=g[n%g.length];const p=t.strictStates[n%t.strictStates.length];const c=e.map(function(e){return e.reduce(function(e,n){const s=`${n.value}-${n.handTo}`;return e[s]=(e[s]||0)+1,e},{})});const y=ee(...c.map(e=>ee(...Object.keys(e).map(n=>e[n]))));let f=m;if(1<=m){const e=c.reduce((e,n)=>ee(e,n["1-0"]||0,n["1-1"]||0),0);0<e&&(f=1-u)}for(let n=0;2>n;n++){const h=e[n];const m=K(...h.map(({value:e})=>e));const g=me.s(0,-Te.y,.5*(m-f)*r);for(let e=0;e<h.length;e++){const v=h[e];if(0===v.value)continue;const b=o[p[n%t.degree][0][e]-1];const x=1===y?0:K(u,(f-u)/(y-1));const w=--c[n][v.value+"-"+v.handTo];let T=f-(y-1)*x;let j=x*w;let k=v.value-(j+T);T*=r,j*=r,k*=r;const _=me.s(0,-Te.y,k/2);const S=O(250-100*s(.5-a.dwell),150,250)-(2===m?50:0);const F=.5*a.ballRadius;const A=K(1e3,500+30*t.greatestValue);const I=O(.5*T+20*t.greatestValue,F,A);let R=.3*I+.7*I*m/t.greatestValue;R=K(3*T,R),R=K(2===m?100:.5*g,R),_>i&&(i=_),R>l&&(l=R);{let e=0===v.handFrom?0:d;let n=0===v.handFrom?S:d-S;a.reversed&&([e,n]=[n,e]),b.animations.push(new fe(T,e,n,R))}{let e=0===v.handFrom?S:d-S;let n=0===v.handTo?0:d;a.reversed&&(v.handFrom===v.handTo?[e,n]=[n,e]:(e+=0===v.handFrom?-S:S,n+=0===v.handFrom?-S:S));const s={x:e,y:0};const t={x:(n-e)/k,y:me.v(0,-Te.y,_)};b.animations.push(new ge(k,s,t,Te)),0<j&&b.animations.push(new ve(j,n,0))}}}}const n=i+l;N(e,d,n,l);const y=t.strictStates[0];for(const n of y)for(let e=0;e<n.length;e++)for(const s of n[e])o[s-1].animations[-1]=new ve(e*r),o[s-1].animationAt=-1}function L(e){e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.restore()}function Z(e,n){const s=e.context;const t=s.canvas;const a=e[je];const o=e[_e];const r=e[ke];if((t.width!==t.clientWidth||t.height!==t.clientHeight)&&(N(e),r))for(const e of o)e.draw(s,a);if(!r){L(s);for(const e of o)e.update(n/a.slowdown),e.draw(s,a)}}var Q=Math.sqrt;var K=Math.min;var ee=Math.max;var z=String.fromCharCode;var ne=Math.floor;class G extends Error{constructor(e){super(e)}}G.prototype.name="SiteswapError";const Y={schedules:new Map,strings:new Map};class B{constructor(e){if(!Array.isArray(e)||!e.every(Array.isArray))throw new Error("Invalid schedule.");let n=Y.schedules.get(e);if(n)return n;const s=e.map(e=>e.join(",")).join("-");return n=Y.strings.get(s),n?n:void(Y.schedules.set(e,this),Y.strings.set(s,this),this.schedule=e)}advance(e){const n=this.schedule.map(e=>e.slice(1));for(let s=0;s<e.length;s++){const t=e[s];if(t.filter(({value:e})=>e).length!==(this.schedule[s][0]||0))throw new Error("Invalid action.");if(t.length)for(const{value:e,handTo:s,handFrom:a}of t)if(!(0>=e)){n[s][e-1]=(n[s][e-1]||0)+1;for(let s=0;s<n.length;s++)for(let t=this.schedule[0].length-1;t<e;t++)n[s][t]||(n[s][t]=0)}}return new B(n)}}let X=!0;const J={ws(){return{allow:" "}},trim(e){const n=J.ws();return{symbols:[n,e,n],processor:([,e])=>e}},separator(){if(X){const e=J.ws();return{either:[{symbols:[e,",",e]}," "],fixed:!0}}return{either:[","," "],fixed:!0}},separated(e,n,s){return{symbols:[s,{repeat:[e,s],min:n-1,max:Infinity}],processor:([e,[...n]])=>[e,...n.map(y)]}},release(e,n){const s=J.separated(n,2,e);return{either:[{symbols:[e]},{symbols:["[",X?J.trim(s):s,"]"],processor:([,e])=>e}]}},asyncSiteswap(e,n){J.ws();return{symbol:J.separated(n,1,J.release(e,n)),processor:e=>e.map(e=>[e])}},syncSiteswap(e,n,s){const t=J.ws();const a=J.release(e,n);if(X){return{symbols:[J.separated(t,1,{symbols:["(",t,a,s,a,t,")"],processor:([,,e,,n])=>[e,n]}),t,{allow:"*"}],processor:([e,,n])=>n?x(e):e}}else{return{symbols:[J.separated(null,1,{symbols:["(",a,s,a,")"],processor:([,e,,n])=>[e,n]}),{allow:"*"}],processor:([e,n])=>n?x(e):e}}}};const se=[{tokenType:"[",regex:"\\["},{tokenType:"]",regex:"\\]"},{tokenType:"(",regex:"\\("},{tokenType:")",regex:"\\)"},{tokenType:"<",regex:"<"},{tokenType:">",regex:">"},{tokenType:"\n",regex:"\n"},{tokenType:"|",regex:"\\|"},{tokenType:"-",regex:"-"},{tokenType:",",regex:","},{tokenType:" ",regex:" +"},{tokenType:"*",regex:"\\*"},{tokenType:"x",regex:"x",processor:()=>!0},{tokenType:"pN",regex:"p(?:[1-9][0-9]*|0)",processor:e=>f(e.slice(1))},{tokenType:"p",regex:"p",processor:()=>!0},{tokenType:"digit",regex:"[0-9]",processor:f},{tokenType:"digit_even",regex:"[02468]",processor:f},{tokenType:"letter",regex:"[a-zA-Z]",processor:v},{tokenType:"letter_even",regex:"[acegikmoqsuwyACEGIKMOQSUWY]",processor:v},{tokenType:"letter_capital",regex:"[A-Z]"},{tokenType:"integer",regex:"[1-9][0-9]*|[0-9]",processor:f},{tokenType:"integer_even",regex:"[1-9][0-9]*[02468]|[02468]",processor:f}];const te={standard_async:function(){return X=!0,{symbol:J.trim(J.asyncSiteswap("integer",J.separator())),processor:w}},compressed_async:function(){return X=!1,{symbol:J.trim(J.asyncSiteswap({either:["digit","letter"]},null)),processor:w}},standard_sync:function(){X=!0;const e=J.separator();return{symbol:J.trim(J.syncSiteswap({symbols:["integer_even",{allow:"x"}],processor:([e,n])=>({value:e,cross:!!n})},e,e)),processor:T}},compressed_sync:function(){X=!1;const e={allow:J.separator(),fixed:!0};return{symbol:J.trim(J.syncSiteswap({symbols:[{either:["digit_even","letter_even"]},{allow:"x"}],processor:([e,n])=>({value:e,cross:!!n})},null,e)),processor:T}},multihand:function(){X=!0;const e=J.ws();const n={either:[{symbols:[{repeat:[{symbol:"letter_capital",fixed:!0,value:"A"}],min:1,max:Infinity},{allow:["letter_capital"]}],processor:([e,n])=>n?[...e,n].join(""):e.join("")},"letter_capital"],processor:c};const s=J.trim(",");const t=J.trim("\n");return{symbol:J.trim({either:[J.separated(t,1,J.separated(s,1,J.release({symbols:[n,"integer"],processor:([e,n])=>({value:n,hand:e})},s))),J.separated(t,1,J.separated(e,1,J.release({symbols:["(",e,{allow:"-"},"integer",e,",",e,"integer",e,")"],processor:([,,e,n,,,,s])=>({value:s,offset:e?-n:n})},e)))]}),processor:j}},passing_async:function(){X=!0;J.ws();const e=J.trim(J.asyncSiteswap({symbols:["integer",{allow:"p"}],processor:([e,n])=>({value:e,pass:n})},J.separator()));const n=J.trim(J.asyncSiteswap({symbols:["integer",{allow:"pN"}],processor:([e,n])=>({value:e,pass:n})},J.separator()));return{symbol:J.trim({either:[{symbols:["<",e,"|",e,">"],processor:([,e,,n])=>[e,n]},{symbols:["<",J.separated("|",2,n),">"],processor:([,e])=>e}]}),processor:k}},passing_sync:function(){X=!0;J.ws();const e=J.separator();const n=J.separator();const s=J.separator();const t=J.separator();const a=J.trim({either:[J.syncSiteswap({symbols:["integer_even",{allow:"x"},{allow:"p"}],processor:([e,n,s])=>({value:e,pass:s,cross:n})},e,e),J.syncSiteswap({symbols:["integer_even",{allow:"p"},{allow:"x"}],processor:([e,n,s])=>({value:e,pass:n,cross:s})},n,n)]});const o=J.trim({either:[J.syncSiteswap({symbols:["integer_even",{allow:"x"},{allow:"pN"}],processor:([e,n,s])=>({value:e,pass:s,cross:n})},s,s),J.syncSiteswap({symbols:["integer_even",{allow:"pN"},{allow:"x"}],processor:([e,n,s])=>({value:e,pass:n,cross:s})},t,t)]});return{symbol:J.trim({either:[{symbols:["<",a,"|",a,">"],processor:([,e,,n])=>[e,n]},{symbols:["<",J.separated("|",2,o),">"],processor:([,e])=>e}]}),processor:_}}};for(let e=0;e<se.length;e++){const n=se[e];n.index=e,te[n.tokenType]=n}const ae={ERROR:!0};let oe;let re=0;const ie={"standard:async":{limits:{degree:{min:1,max:1}},hands:()=>["Hand"],parse:e=>I("standard_async",e),unparse:e=>e.map(([e])=>1===e.length?e[0].value:`[${e.map(({value:e})=>e).join(",")}]`).join(",")},"standard:sync":{limits:{degree:{min:2,max:2}},hands:()=>["Left","Right"],parse:e=>I("standard_sync",e),unparse:e=>e.map(e=>"("+e.map(e=>1===e.length?R(e[0]):`[${e.map(R).join(",")}]`)+")").join("")},standard:["standard:async","standard:sync"],"compressed:async":{limits:{degree:{min:1,max:1},greatestValue:{max:61}},hands:()=>["Hand"],parse:e=>I("compressed_async",e),unparse:e=>e.map(([e])=>1===e.length?e[0].value:`[${e.map(({value:e})=>e).join("")}]`).join("")},"compressed:sync":{limits:{degree:{min:2,max:2},greatestValue:{max:61}},hands:()=>["Left","Right"],parse:e=>I("compressed_sync",e),unparse:e=>e.map(e=>"("+e.map(e=>1===e.length?C(e[0]):`[${e.map(C).join("")}]`)+")").join("")},compressed:["compressed:async","compressed:sync"],"passing:async":{limits:{degree:{min:2}},hands:e=>Array(e).fill().map((e,n)=>`juggler ${n+1}`),parse:e=>I("passing_async",e),unparse:function(e){const n=e[0].length;const s=[];for(let t=0;t<n;t++)s.push(e.map(e=>$(e[t])).join(","));return`<${s.join("|")}>`}},"passing:sync":{limits:{degree:{min:4,step:2}},hands:e=>Array(e).fill().map((e,n)=>`juggler ${ne(n/2)+1}, hand ${n%2+1}`),parse:e=>I("passing_sync",e),unparse:function(e){const n=e[0].length;const s=[];for(let t=0;t<n;t+=2)s.push(e.map(e=>`(${P(e[t])},${P(e[t+1])})`).join(""));return`<${s.join("|")}>`}},passing:["passing:async","passing:sync"],multihand:{hands:e=>Array(e).fill().map((e,n)=>g(n)),parse:e=>I("multihand",e),unparse:function(e){const n=e[0].length;const s=[];for(let t=0;t<n;t++){const n=e.map(e=>V(e[t])).join(",");s.push(n)}return s.join("\n")}}};class Siteswap{constructor(n,s="compressed"){try{const{throws:a,notation:o}=H(n,[].concat(s));e(a),this.valid=!0,this.notation=o,this.throws=t(a)}catch(e){if(!(e instanceof G))throw e;return this.valid=!1,this.input=[n,s],this.error=e.message,this}const a=this.throws;const i=a.reduce((e,n)=>e.concat(...n.map(e=>e.map(({value:e})=>e))),[]);this.degree=a[0].length,this.props=i.reduce((e,n)=>e+n)/a.length,this.multiplex=a.reduce((e,n)=>ee(e,...n.map(({length:e})=>e)),0),this.greatestValue=ee(...i),this.states=o(this),this.strictStates=r(this),this.orbits=h(this),this.composition=u(this),this.period=this.states.length,this.fullPeriod=this.strictStates.length,this.prime=1===this.composition.length,this.groundState=this.states.some(q)}}Siteswap.prototype.equals=function(e){if(!this.valid)throw new G("Invalid siteswap.");if(!(e instanceof Siteswap)||!e.valid)return!1;const n=this.throws;const s=e.throws;if(n.length!==s.length)return!1;for(let t=0;t<n.length;t++)if(W(n,s,t))return!0;return!1},Siteswap.prototype.rotate=function(e=1){if(!this.valid)throw new G("Invalid siteswap.");const n=this.throws;return 0>e&&(e=n.length+e%n.length),new Siteswap(n.map((s,t)=>n[(t+e)%n.length]),this.notation)},Siteswap.prototype.toString=function(e=this.notation){if(!this.valid)throw new G("Invalid siteswap.");if(null===e)return JSON.stringify(this.throws);if(!ie[e]||Array.isArray(ie[e]))throw new G("Unsupported notation.");if(this.notation!==e){const n=ie[this.notation].limits||{};const s=ie[e].limits||{};const t=Object.keys(s);if(t.some(e=>void 0!==s[e]&&void 0!==n[e]&&void 0!==s[e].min&&void 0!==n[e].max&&s[e].min>n[e].max||void 0!==s[e].max&&void 0!==n[e].min&&s[e].max<n[e].min))throw new G("Incompatible notations.");if(t.some(e=>s[e].max&&this[e]>s[e].max||s[e].min&&this[e]<s[e].min||0!=this[e]%(s[e].step||1)))throw new G("This siteswap can't be converted to the target notation.")}return ie[e].unparse(this.throws)},Siteswap.prototype.log=function(){if(!this.valid)return void console.log("Invalid siteswap.");const e=[];let n;if(e.push(`siteswap\n ${this.toString().replace(/\n/g,"\n ")}`),e.push(`notation\n ${this.notation}`),e.push(`degree\n ${this.degree}`),e.push(`props\n ${this.props}`),e.push(`period\n ${this.period}`),e.push(`full period\n ${this.fullPeriod}`),e.push(`multiplex\n ${this.multiplex}`),e.push(`prime\n ${this.prime}`),e.push(`ground state\n ${this.groundState}`),2<this.degree){n=Array(this.degree).fill().map((e,n)=>g(n)),e.push("hand labels");const s=ie[this.notation].hands(this.degree);const t=[this.degree.toString().length+1,ee(...s.map(({length:e})=>e)),ee(...n.map(({length:e})=>e))];for(let a=0;a<this.degree;a++){const o=U(a+1,t[0]);const r=U(n[a],t[2]);const i=U(s[a],t[1]);e.push(`${o}| ${r}${"multihand"===this.notation?"":` (${i})`}`)}}e.push("throw sequence");{const s=[];for(const[e,t]of this.throws.entries()){const a=t.map(e=>{let s;return s=2>=this.degree?e.map(({value:e,handFrom:n,handTo:s})=>`${e}${n===s?"":"x"}`).join(","):e.map(({value:e,handFrom:s,handTo:t})=>`${e}${n[t]}`).join(","),1===e.length?s:`[${s}]`});s.push([`${e+1}|`,...a])}const t=[];for(let e=0;e<s[0].length;e++)t.push(ee(...s.map(n=>n[e].length+1)));e.push(...s.map(e=>e.map((e,n)=>U(e,t[n])).join("")))}e.push("states");{const n=this.period.toString().length+1;for(const[s,t]of this.states.entries())for(const[a,o]of t.entries())e.push(`${U(a?" ":s+1,n)}| [${o.join(",")}]`)}e.push("strict states");{const n=this.fullPeriod.toString().length+1;for(const[s,t]of this.strictStates.entries())for(const[a,o]of t.entries())e.push(`${U(a?"":s+1,n)}| [${o.map(e=>`[${e.length?e.join(","):"-"}]`).join(",")}]`)}e.push("orbits");{const n=this.orbits.length.toString().length+1;for(const[s,t]of this.orbits.entries())e.push(...t.toString().split("\n").map((e,t)=>`${U(t?"":s+1,n)}| ${e}`))}e.push("composition");{const n=this.composition.length.toString().length+1;for(const[s,t]of this.composition.entries())e.push(...t.toString().split("\n").map((e,t)=>`${U(t?"":s+1,n)}| ${e}`))}e.push(" "),console.log(e.join("\n"))};const le=Symbol.for("settings");var pe="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window;var de=function(e,n){return n={exports:{}},e(n,n.exports),n.exports}(function(e){(function(n,s){e.exports=s()})(pe,function(){function _(n){if(!$(n))throw new O("Invalid throws structure.");const s=n.map(e=>e.map(()=>0));for(let t=0;t<n.length;t++){const a=n[t];for(const o of a)for(const e of o)s[t][e.handFrom]++,s[(t+e.value)%n.length][e.handTo]--}if(s.some(e=>e.some(e=>0!==e)))throw new O("Invalid siteswap.")}function $(e){if(!Array.isArray(e)||!e.length)return!1;for(const n of e){if(!Array.isArray(n)||n.length!==e[0].length)return!1;if(n.some(e=>!Array.isArray(e)||!e.every(({value:e,handFrom:s,handTo:t})=>void 0!==e&&void 0!==s&&void 0!==t&&s<n.length&&t<n.length)))return!1}return!0}function Z(n,s){if(n.length!==s.length)return!1;for(let t=0;t<n.length;t++){const o=n[t],r=s[t];if(o.length!==r.length)return!1;for(let e=0;e<o.length;e++){const n=o[e],s=r[e];if(n.length!==s.length)return!1;for(let t=0;t<n.length;t++){const a=n[t],o=s[t];if(a.value!==o.value||a.handFrom!==o.handFrom||a.handTo!==o.handTo)return!1}}}return!0}function a(n){for(let s=1,e=N(n.length/2);s<=e;s++)if(0==n.length%s){const t=n.slice(0,s);for(let a=s;a<n.length;a+=s){const e=n.slice(a,a+s);if(!Z(t,e))break;if(s+a===n.length)return n.length=s,n}}return n}function se(n){const s=[];for(let e=0;e<n.degree;e++)s.push(Array(n.greatestValue).fill(0));if(0===n.greatestValue)return new P(s);const t=n.throws;let a=0;for(let o=-1;;o--){const e=t[(o%t.length+t.length)%t.length];for(const t of e)for(const e of t){const t=o+e.value;if(!(0>t)&&(s[e.handTo][t]++,a++,a===n.props)){let e=n.greatestValue;for(;s.every(n=>0===n[e-1]);)e--;for(let t=0;t<n.degree;t++)s[t].length=e;return new P(s)}}}}function d(e){const n=[],s=se(e);let t=s;do for(const s of e.throws)n.push(t.schedule),t=t.advance(s);while(s!==t);return n}function f(n){const s=[],t=e(n.states[0]);let a=t;do for(const e of n.throws)s.push(a),a=h(a,e);while(!i(t,a));return s}function e(e){let n=0;return e.map(e=>e.map(e=>Array(e).fill().map(()=>++n)))}function h(n,s){const t=n.map(e=>e.slice(1).map(e=>[...e]));for(let o=0;o<s.length;o++){const a=s[o];if(a.length||!a.every(({value:e,handTo:n,handFrom:s})=>0===e&&n===o&&s===o))for(let e=0;e<a.length;e++){const s=a[e];if(0>=s.value)continue;const o=n[s.handFrom][0][e];for(let a=0;a<t.length;a++)for(let o=n[0].length-1;o<s.value;o++)t[a][o]||(t[a][o]=[]);t[s.handTo][s.value-1].push(o)}}return t}function i(n,s){if(n.length!==s.length)return!1;for(let t=0;t<n.length;t++){const o=n[t],r=s[t];if(o.length!==r.length)return!1;for(let e=0;e<o.length;e++){const n=o[e],s=r[e];if(n.length!==s.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==s[e])return!1}}return!0}function j(n,s,t,a,o){const e=t[a][o];for(const r of e){if(0===r.value)continue;const o=(a+r.value)%t.length;s[o][r.handTo]===n||(s[o][r.handTo]=n,j(n,s,t,o,r.handTo))}}function g(n){const{throws:s,notation:t}=n,o=[],r=s.map(e=>e.map(()=>null));for(let e=0;e<s.length;e++){const n=s[e];for(let t=0;t<n.length;t++){const a=n[t];if(null===r[e][t]&&(1!==a.length||0!==a[0].value)){const n=[];j(n,r,s,e,t),o.push(n)}}}if(1===o.length)return[n];for(let e=0;e<s.length;e++){const n=s[e];for(const s of o)s.push(n.map((n,t)=>r[e][t]===s?n:[{value:0,handFrom:t,handTo:t}]))}return o.map(e=>new Siteswap(e,t))}function l(n){const s=[],t=[...n.throws],a=[...n.states],o=n.notation;let e=0;for(let r=1;r<=a.length;r++)for(let i=r-1;i>=e;i--)if(a[r%a.length]===a[i]){if(0==i&&r===a.length)return s.length?(m(s,new Siteswap(t.slice(i,r),o)),s):[n];e==i?(m(s,new Siteswap(t.slice(i,r),o)),e=r):(m(s,new Siteswap(t.splice(i,r-i),o)),a.splice(i,r-i),r=e);break}return s}function m(e,n){e.every(e=>!e.equals(n))&&e.push(n)}function n(e){return"A".repeat(N(e/26))+z(65+e%26)}function o(e){let n=0;for(;"A"===e[n];)n++;return n<e.length-1?null:n===e.length?26*(n-1):26*n+e[n].charCodeAt(0)-65}function p([,e]){return e}function c(e){return+e}function r(e){return"a">e?e.charCodeAt(0)-65+36:e.charCodeAt(0)-97+10}function s(n,s){const t=M(n,s),a=K(n,s);let o=t;for(;0!=o%a;)o+=t;return o}function t(e){return e.concat(e.map(e=>e.map(e=>[...e]).reverse()))}function u(e){for(const n of e)for(const e of n)for(let n=0;n<e.length;n++)e[n]={value:e[n],handFrom:0,handTo:0};return e}function v(e){for(const n of e)for(let s=0;s<n.length;s++){const t=n[s];for(let n=0;n<t.length;n++){const{value:a,cross:o}=t[n];t[n]={value:a/2,handFrom:s,handTo:o?1-s:s}}}return e}function w(e){const n=e.map(({length:e})=>e).reduce(s),t=[];for(let s=0;s<n;s++){const n=e.map(e=>e[s%e.length]).map(function(e,n){return e.map(function({value:s,hand:t,offset:a}){const o=void 0===a?t:n+a;return{value:s,handFrom:n,handTo:o}})});t.push(n)}return t}function x(e){const n=e.map(({length:e})=>e).reduce(s),t=[];for(let s=0;s<n;s++){const n=e.map(e=>e[s%e.length][0]).map(function(e,n){return e.map(function({value:e,pass:s}){!0===s&&(s=2-n);const t=null===s?n:s-1;return{value:e,handFrom:n,handTo:t}})});t.push(n)}return t}function y(e){const n=e.map(({length:e})=>e).reduce(s),t=[];for(let s=0;s<n;s++){const n=Array.prototype.concat(...e.map(e=>e[s%e.length])).map(function(e,n){return e.map(function({value:s,pass:t,cross:a}){!0===t&&(t=2-N(n/2));const o=(null===t?n:2*(t-1)+n%2)+(a?n%2?-1:1:0);return{value:s/2,handFrom:n,handTo:o}})});t.push(n)}return t}function k(e,n=null){if(null===n){const n={};return n.immutables=[],n.terminals=new Set,e=k(e,n),e.immutables=n.immutables,e.terminals=[...n.terminals],e}if(null===e)return e;if("string"==typeof e){if(!T[e])throw new Error("Parsing error.");return k(T[e],n)}if(Array.isArray(e))return{symbols:e.map(e=>k(e,n))};if(e.fixed&&!e.value&&n.immutables.push(e),e.tokenType)return n.terminals.add(e),e;if("object"!=typeof e)throw new Error("Parsing error.");if(e.symbol)e.symbol=k(e.symbol,n);else if(e.symbols)e.symbols=e.symbols.map(e=>k(e,n));else if(e.repeat)e.repeat=e.repeat.map(e=>k(e,n));else if(e.either)e.either=e.either.map(e=>k(e,n));else if(e.allow)e.either=[k(e.allow,n),null],delete e.allow;else throw new Error("Parsing error.");return e}function A(n,s){const t=new RegExp(n.sort((e,n)=>e.index-n.index).map(({regex:e})=>`(${e})`).join("|"),"y"),a=[];for(;t.lastIndex<s.length;){const o=t.exec(s);if(null===o)return null;const e=o.findIndex((e,n)=>n&&e);a.push({type:n[e-1].tokenType,value:o[e]})}return a}function q(n){let e;if(null===n)return null;if(n.tokenType){const s=V[W];if(!s||s.type!==n.tokenType)return U;if(n.fixed)if(!n.value)n.value=s.value;else if(s.value!==n.value)return U;e=s.value,W++}else if(n.symbol){if(e=q(n.symbol),e===U)return U;}else if(n.symbols){e=[];for(const s of n.symbols){const n=q(s);if(n===U)return U;e.push(n)}}else if(n.repeat){for(e=[];e.length<n.max;){const s=W,t=q({symbols:n.repeat});if(t===U){W=s;break}e.push(t)}if(e.length<n.min||e.length>n.max)return U}else if(n.either){for(const s of n.either){const t=W,a=q(s);if(a===U){W=t;continue}const o=n.processor;if(n.fixed)if(void 0===n.value)n.value=s;else if(s!==n.value)return U;return o?o(a):a}return U}return n.processor?n.processor(e):e}function b(e,n){if(!e||!T[e])throw new Error("Parsing error.");"function"==typeof T[e]&&(T[e]=k(T[e]()));const s=T[e];for(const t of s.immutables)delete t.value;if(W=0,V=A(s.terminals,n),!V||!V.length)return null;const t=q(s);return t===U||W!==V.length?null:t}function C({value:e,handFrom:n,handTo:s}){return`${2*e}${n===s?"":"x"}`}function D({value:e,handFrom:n,handTo:s}){return`${2*e}${n===s?"":"x"}`}function F(e){const n=e.map(({value:e,handFrom:n,handTo:s})=>`${e}${n===s?"":`p${s+1}`}`).join(",");return 1===e.length?n:`[${n}]`}function E(e){const n=e.map(({value:e,handFrom:n,handTo:s})=>`${2*e}${n%2==s%2?"":"x"}${s===n||s===n+(n%2?-1:1)?"":"p"+(N(s/2)+1)}`).join(",");return 1===e.length?n:`[${n}]`}function H(e){const s=e.map(({value:e,handTo:s})=>`${n(s)}${e}`).join(",");return 1===e.length?s:`[${s}]`}function I(e,n){if(n=n.reduce((e,n)=>e.concat(Array.isArray(X[n])?X[n]:n),[]),"object"==typeof e){const s=n[0];if(("string"!=typeof s||!X[s])&&null!==s)throw new O("Unsupported notation.");return{notation:s,throws:e}}if(n.some(e=>"string"!=typeof e||!X[e]))throw new O("Unsupported notation.");for(const s of n){const n=X[s].parse(e);if(n)return{notation:s,throws:n}}throw new O("Invalid syntax.")}function G(e){return e.every(e=>e.every((e,n,{length:s})=>1===e||0===e&&n===s-1))}function B(n,s,t){for(let a=0;a<n.length;a++){const o=(a+t)%n.length;if(n[o].length!==s[a].length)return!1;for(let e=0;e<n[o].length;e++){if(n[o][e].length!==s[a][e].length)return!1;for(let t=0;t<n[o][e].length;t++){const r=n[o][e][t],i=s[a][e][t];if(r.value!==i.value||r.handFrom!==i.handFrom||r.handTo!==i.handTo)return!1}}}return!0}function L(e,n){return"string"!=typeof e&&(e=e.toString()),n++,e.length>=n?e:`${Array(n-e.length).join(" ")}${e}`}var M=ee,N=ne;class O extends Error{constructor(e){super(e)}}O.prototype.name="SiteswapError";const J={schedules:new Map,strings:new Map};class P{constructor(e){if(!Array.isArray(e)||!e.every(Array.isArray))throw new Error("Invalid schedule.");let n=J.schedules.get(e);if(n)return n;const s=e.map(e=>e.join(",")).join("-");return n=J.strings.get(s),n?n:void(J.schedules.set(e,this),J.strings.set(s,this),this.schedule=e)}advance(e){const n=this.schedule.map(e=>e.slice(1));for(let s=0;s<e.length;s++){const t=e[s];if(t.filter(({value:e})=>e).length!==(this.schedule[s][0]||0))throw new Error("Invalid action.");if(t.length)for(const{value:s,handTo:a,handFrom:o}of t)if(!(0>=s)){n[a][s-1]=(n[a][s-1]||0)+1;for(let e=0;e<n.length;e++)for(let t=this.schedule[0].length-1;t<s;t++)n[e][t]||(n[e][t]=0)}}return new P(n)}}let Q=!0;const R={ws(){return{allow:" "}},trim(e){const n=R.ws();return{symbols:[n,e,n],processor:([,e])=>e}},separator(){if(Q){const e=R.ws();return{either:[{symbols:[e,",",e]}," "],fixed:!0}}return{either:[","," "],fixed:!0}},separated(e,n,s){return{symbols:[s,{repeat:[e,s],min:n-1,max:Infinity}],processor:([e,[...n]])=>[e,...n.map(p)]}},release(e,n){const s=R.separated(n,2,e);return{either:[{symbols:[e]},{symbols:["[",Q?R.trim(s):s,"]"],processor:([,e])=>e}]}},asyncSiteswap(e,n){return R.ws(),{symbol:R.separated(n,1,R.release(e,n)),processor:e=>e.map(e=>[e])}},syncSiteswap(n,s,a){const o=R.ws(),r=R.release(n,s);return Q?{symbols:[R.separated(o,1,{symbols:["(",o,r,a,r,o,")"],processor:([,,e,,n])=>[e,n]}),o,{allow:"*"}],processor:([e,,n])=>n?t(e):e}:{symbols:[R.separated(null,1,{symbols:["(",r,a,r,")"],processor:([,e,,n])=>[e,n]}),{allow:"*"}],processor:([e,n])=>n?t(e):e}}},S=[{tokenType:"[",regex:"\\["},{tokenType:"]",regex:"\\]"},{tokenType:"(",regex:"\\("},{tokenType:")",regex:"\\)"},{tokenType:"<",regex:"<"},{tokenType:">",regex:">"},{tokenType:"\n",regex:"\n"},{tokenType:"|",regex:"\\|"},{tokenType:"-",regex:"-"},{tokenType:",",regex:","},{tokenType:" ",regex:" +"},{tokenType:"*",regex:"\\*"},{tokenType:"x",regex:"x",processor:()=>!0},{tokenType:"pN",regex:"p(?:[1-9][0-9]*|0)",processor:e=>c(e.slice(1))},{tokenType:"p",regex:"p",processor:()=>!0},{tokenType:"digit",regex:"[0-9]",processor:c},{tokenType:"digit_even",regex:"[02468]",processor:c},{tokenType:"letter",regex:"[a-zA-Z]",processor:r},{tokenType:"letter_even",regex:"[acegikmoqsuwyACEGIKMOQSUWY]",processor:r},{tokenType:"letter_capital",regex:"[A-Z]"},{tokenType:"integer",regex:"[1-9][0-9]*|[0-9]",processor:c},{tokenType:"integer_even",regex:"[1-9][0-9]*[02468]|[02468]",processor:c}],T={standard_async:function(){return Q=!0,{symbol:R.trim(R.asyncSiteswap("integer",R.separator())),processor:u}},compressed_async:function(){return Q=!1,{symbol:R.trim(R.asyncSiteswap({either:["digit","letter"]},null)),processor:u}},standard_sync:function(){Q=!0;const e=R.separator();return{symbol:R.trim(R.syncSiteswap({symbols:["integer_even",{allow:"x"}],processor:([e,n])=>({value:e,cross:!!n})},e,e)),processor:v}},compressed_sync:function(){Q=!1;const e={allow:R.separator(),fixed:!0};return{symbol:R.trim(R.syncSiteswap({symbols:[{either:["digit_even","letter_even"]},{allow:"x"}],processor:([e,n])=>({value:e,cross:!!n})},null,e)),processor:v}},multihand:function(){Q=!0;const e=R.ws(),n={either:[{symbols:[{repeat:[{symbol:"letter_capital",fixed:!0,value:"A"}],min:1,max:Infinity},{allow:["letter_capital"]}],processor:([e,n])=>n?[...e,n].join(""):e.join("")},"letter_capital"],processor:o},s=R.trim(","),t=R.trim("\n");return{symbol:R.trim({either:[R.separated(t,1,R.separated(s,1,R.release({symbols:[n,"integer"],processor:([e,n])=>({value:n,hand:e})},s))),R.separated(t,1,R.separated(e,1,R.release({symbols:["(",e,{allow:"-"},"integer",e,",",e,"integer",e,")"],processor:([,,e,n,,,,s])=>({value:s,offset:e?-n:n})},e)))]}),processor:w}},passing_async:function(){Q=!0;const e=R.ws(),n=R.trim(R.asyncSiteswap({symbols:["integer",{allow:"p"}],processor:([e,n])=>({value:e,pass:n})},R.separator())),s=R.trim(R.asyncSiteswap({symbols:["integer",{allow:"pN"}],processor:([e,n])=>({value:e,pass:n})},R.separator()));return{symbol:R.trim({either:[{symbols:["<",n,"|",n,">"],processor:([,e,,n])=>[e,n]},{symbols:["<",R.separated("|",2,s),">"],processor:([,e])=>e}]}),processor:x}},passing_sync:function(){Q=!0;const n=R.ws(),s=R.separator(),t=R.separator(),a=R.separator(),o=R.separator(),e=R.trim({either:[R.syncSiteswap({symbols:["integer_even",{allow:"x"},{allow:"p"}],processor:([e,n,s])=>({value:e,pass:s,cross:n})},s,s),R.syncSiteswap({symbols:["integer_even",{allow:"p"},{allow:"x"}],processor:([e,n,s])=>({value:e,pass:n,cross:s})},t,t)]}),r=R.trim({either:[R.syncSiteswap({symbols:["integer_even",{allow:"x"},{allow:"pN"}],processor:([e,n,s])=>({value:e,pass:s,cross:n})},a,a),R.syncSiteswap({symbols:["integer_even",{allow:"pN"},{allow:"x"}],processor:([e,n,s])=>({value:e,pass:n,cross:s})},o,o)]});return{symbol:R.trim({either:[{symbols:["<",e,"|",e,">"],processor:([,e,,n])=>[e,n]},{symbols:["<",R.separated("|",2,r),">"],processor:([,e])=>e}]}),processor:y}}};for(let e=0;e<S.length;e++){const n=S[e];n.index=e,T[n.tokenType]=n}const U={ERROR:!0};let V,W=0;const X={"standard:async":{limits:{degree:{min:1,max:1}},hands:()=>["Hand"],parse:e=>b("standard_async",e),unparse:e=>e.map(([e])=>1===e.length?e[0].value:`[${e.map(({value:e})=>e).join(",")}]`).join(",")},"standard:sync":{limits:{degree:{min:2,max:2}},hands:()=>["Left","Right"],parse:e=>b("standard_sync",e),unparse:e=>e.map(e=>"("+e.map(e=>1===e.length?C(e[0]):`[${e.map(C).join(",")}]`)+")").join("")},standard:["standard:async","standard:sync"],"compressed:async":{limits:{degree:{min:1,max:1},greatestValue:{max:61}},hands:()=>["Hand"],parse:e=>b("compressed_async",e),unparse:e=>e.map(([e])=>1===e.length?e[0].value:`[${e.map(({value:e})=>e).join("")}]`).join("")},"compressed:sync":{limits:{degree:{min:2,max:2},greatestValue:{max:61}},hands:()=>["Left","Right"],parse:e=>b("compressed_sync",e),unparse:e=>e.map(e=>"("+e.map(e=>1===e.length?D(e[0]):`[${e.map(D).join("")}]`)+")").join("")},compressed:["compressed:async","compressed:sync"],"passing:async":{limits:{degree:{min:2}},hands:e=>Array(e).fill().map((e,n)=>`juggler ${n+1}`),parse:e=>b("passing_async",e),unparse:function(e){const n=e[0].length,s=[];for(let t=0;t<n;t++)s.push(e.map(e=>F(e[t])).join(","));return`<${s.join("|")}>`}},"passing:sync":{limits:{degree:{min:4,step:2}},hands:e=>Array(e).fill().map((e,n)=>`juggler ${N(n/2)+1}, hand ${n%2+1}`),parse:e=>b("passing_sync",e),unparse:function(e){const n=e[0].length,s=[];for(let t=0;t<n;t+=2)s.push(e.map(e=>`(${E(e[t])},${E(e[t+1])})`).join(""));return`<${s.join("|")}>`}},passing:["passing:async","passing:sync"],multihand:{hands:e=>Array(e).fill().map((e,s)=>n(s)),parse:e=>b("multihand",e),unparse:function(e){const n=e[0].length,s=[];for(let t=0;t<n;t++){const n=e.map(e=>H(e[t])).join(",");s.push(n)}return s.join("\n")}}};class Siteswap{constructor(n,s="compressed"){try{const{throws:t,notation:e}=I(n,[].concat(s));_(t),this.valid=!0,this.notation=e,this.throws=a(t)}catch(e){if(!(e instanceof O))throw e;return this.valid=!1,this.input=[n,s],this.error=e.message,this}const t=this.throws,e=t.reduce((e,n)=>e.concat(...n.map(e=>e.map(({value:e})=>e))),[]);this.degree=t[0].length,this.props=e.reduce((e,n)=>e+n)/t.length,this.multiplex=t.reduce((e,n)=>M(e,...n.map(({length:e})=>e)),0),this.greatestValue=M(...e),this.states=d(this),this.strictStates=f(this),this.orbits=g(this),this.composition=l(this),this.period=this.states.length,this.fullPeriod=this.strictStates.length,this.prime=1===this.composition.length,this.groundState=this.states.some(G)}}return Siteswap.prototype.equals=function(e){if(!this.valid)throw new O("Invalid siteswap.");if(!(e instanceof Siteswap)||!e.valid)return!1;const n=this.throws,s=e.throws;if(n.length!==s.length)return!1;for(let t=0;t<n.length;t++)if(B(n,s,t))return!0;return!1},Siteswap.prototype.rotate=function(e=1){if(!this.valid)throw new O("Invalid siteswap.");const n=this.throws;return 0>e&&(e=n.length+e%n.length),new Siteswap(n.map((s,t)=>n[(t+e)%n.length]),this.notation)},Siteswap.prototype.toString=function(e=this.notation){if(!this.valid)throw new O("Invalid siteswap.");if(null===e)return JSON.stringify(this.throws);if(!X[e]||Array.isArray(X[e]))throw new O("Unsupported notation.");if(this.notation!==e){const n=X[this.notation].limits||{},s=X[e].limits||{},t=Object.keys(s);if(t.some(e=>void 0!==s[e]&&void 0!==n[e]&&void 0!==s[e].min&&void 0!==n[e].max&&s[e].min>n[e].max||void 0!==s[e].max&&void 0!==n[e].min&&s[e].max<n[e].min))throw new O("Incompatible notations.");if(t.some(e=>s[e].max&&this[e]>s[e].max||s[e].min&&this[e]<s[e].min||0!=this[e]%(s[e].step||1)))throw new O("This siteswap can't be converted to the target notation.")}return X[e].unparse(this.throws)},Siteswap.prototype.log=function(){if(!this.valid)return void console.log("Invalid siteswap.");const s=[];let t;if(s.push(`siteswap\n ${this.toString().replace(/\n/g,"\n ")}`),s.push(`notation\n ${this.notation}`),s.push(`degree\n ${this.degree}`),s.push(`props\n ${this.props}`),s.push(`period\n ${this.period}`),s.push(`full period\n ${this.fullPeriod}`),s.push(`multiplex\n ${this.multiplex}`),s.push(`prime\n ${this.prime}`),s.push(`ground state\n ${this.groundState}`),2<this.degree){t=Array(this.degree).fill().map((e,s)=>n(s)),s.push("hand labels");const a=X[this.notation].hands(this.degree),o=[];o.push(this.degree.toString().length+1),o.push(M(...a.map(({length:e})=>e))),o.push(M(...t.map(({length:e})=>e)));for(let n=0;n<this.degree;n++){const e=L(n+1,o[0]),r=L(t[n],o[2]),i=L(a[n],o[1]);s.push(`${e}| ${r}${"multihand"===this.notation?"":` (${i})`}`)}}s.push("throw sequence");{const n=[];for(const[s,a]of this.throws.entries()){const o=a.map(e=>{let n;return n=2>=this.degree?e.map(({value:e,handFrom:n,handTo:s})=>`${e}${n===s?"":"x"}`).join(","):e.map(({value:e,handFrom:n,handTo:s})=>`${e}${t[s]}`).join(","),1===e.length?n:`[${n}]`});n.push([`${s+1}|`,...o])}const e=[];for(let s=0;s<n[0].length;s++)e.push(M(...n.map(e=>e[s].length+1)));s.push(...n.map(n=>n.map((n,s)=>L(n,e[s])).join("")))}s.push("states");{const n=this.period.toString().length+1;for(const[t,a]of this.states.entries())for(const[o,e]of a.entries())s.push(`${L(o?" ":t+1,n)}| [${e.join(",")}]`)}s.push("strict states");{const n=this.fullPeriod.toString().length+1;for(const[t,a]of this.strictStates.entries())for(const[o,e]of a.entries())s.push(`${L(o?"":t+1,n)}| [${e.map(e=>`[${e.length?e.join(","):"-"}]`).join(",")}]`)}s.push("orbits");{const e=this.orbits.length.toString().length+1;for(const[n,t]of this.orbits.entries())s.push(...t.toString().split("\n").map((s,t)=>`${L(t?"":n+1,e)}| ${s}`))}s.push("composition");{const e=this.composition.length.toString().length+1;for(const[n,t]of this.composition.entries())s.push(...t.toString().split("\n").map((s,t)=>`${L(t?"":n+1,e)}| ${s}`))}s.push(" "),console.log(s.join("\n"))},Siteswap})});class he{constructor(e){this.callback=e,this.update=this.update.bind(this),this.request=window.requestAnimationFrame(this.update),this.timestamp=null}update(e){const n=this.timestamp?e-this.timestamp:0;this.timestamp=e,this.request=window.requestAnimationFrame(this.update),this.callback(n)}kill(){window.cancelAnimationFrame(this.request)}}class ue{constructor(e){this.position={x:NaN,y:NaN},this.color=e,this.animationAt=0,this.animations=[],this.elapsed=0}update(e){this.elapsed+=e;const n=this.animations[this.animationAt];return this.elapsed>=n.duration?(this.animationAt=(this.animationAt+1)%this.animations.length,this.elapsed-=n.duration,this.update(0)):void(this.position=n.getPosition(this.elapsed))}draw(e,n){const s=n.ballRadius*n.multiplier;const t=this.position.x*n.multiplier;const a=this.position.y*n.multiplier;e.beginPath(),e.arc(t,a,s,0,2*Math.PI),e.fillStyle=this.color,e.globalAlpha=0<this.position.y?.9:.55,e.fill(),e.closePath()}}const me={s:(e,n,s)=>e*s+.5*n*s*s,v:(e,n,t)=>Q(e*e+2*n*t)};class ge{constructor(e,n,s,t){this.duration=e,this.position=n,this.velocity=s,this.acceleration=t}getPosition(e){const n={x:this.position.x+me.s(this.velocity.x,this.acceleration.x,e),y:this.position.y+me.s(this.velocity.y,this.acceleration.y,e)};return n}}class ce{constructor(e){this.coefficients=e}at(e){return this.coefficients.reduce((n,s)=>s+e*n)}differentiate(){return new ce(this.coefficients.slice(0,-1).map((e,n,{length:s})=>(s-n)*e))}}const ye=new class{constructor(e,s=0,t=0){this.polynomials=[],this.xs=e.map(({x:e})=>e),this.ys=e.map(({y:e})=>e);const a=this.xs.length;const n=[];const o=[];const r=[];const l=[];const p=[];for(let r=0;r<a-1;r++)n[r]=this.xs[r+1]-this.xs[r],o[r]=(this.ys[r+1]-this.ys[r])/n[r];r[0]=2*(n[0]+n[1]),l[0]=6*(o[1]-o[0]);for(let p=1;p<a-1;p++)r[p]=2*(n[p]+n[p-1])-n[p-1]*n[p-1]/r[p-1],l[p]=6*(o[p]-o[p-1])-n[p-1]*l[p-1]/r[p-1];p[0]=s,p[a-1]=t;for(let o=a-2;0<o;o--)p[o]=(l[o]-n[o]*p[o+1])/r[o];for(let o=0;o<a-1;o++){const e=this.ys[o];const s=-(n[o]*p[o+1]/6)-n[o]*p[o]/3+(this.ys[o+1]-this.ys[o])/n[o];const t=p[o]/2;const r=(p[o+1]-p[o])/(6*n[o]);this.polynomials.push(new ce([r,t,s,e]))}}at(e){const s=this.xs;const t=this.polynomials.length;const n=K(s[0],s[t]);const a=ee(s[0],s[t]);if(e<n||e>a)throw new Error("Out of bounds.");let o=0;if(s[0]<s[t])for(;o<t&&e>s[o+1];)o++;else for(;o<t&&e<s[o+1];)o++;return this.polynomials[o].at(e-s[o])}maximum(){const e={x:null,y:null};const n=this.xs;for(let s=0;s<this.polynomials.length;s++){const t=this.polynomials[s].differentiate();const o=t.coefficients[0];const a=t.coefficients[1];const r=t.coefficients[2];const i=Q(a*a-4*o*r);const l=(-a+i)/(2*o)+n[s];const p=(-a-i)/(2*o)+n[s];const d=K(n[s],n[s+1]);const h=ee(n[s],n[s+1]);if(l>=d&&l<=h){const n=this.at(l);n>e.y&&(e.x=l,e.y=n)}if(p>=d&&p<=h){const n=this.at(p);n>e.y&&(e.x=p,e.y=n)}}return e}}([{x:0,y:0},{x:5,y:30},{x:30,y:100},{x:95,y:30},{x:100,y:0}]);class fe{constructor(e,n,s,t){this.duration=e,this.width=s-n,this.yModifier=t/ye.maximum().y,this.position={x:n,y:0}}getPosition(e){const n=e/this.duration;const s={x:this.position.x+n*this.width,y:this.position.y-ye.at(100*n)*this.yModifier};return s}}class ve{constructor(e,n,s){this.duration=e,this.position={x:n,y:s}}getPosition(){return this.position}}const be=Symbol.for("settings");const xe=Symbol.for("settings");const we=Symbol.for("balls");const Te={x:0,y:-9.81/1e3};const je=Symbol.for("settings");const ke=Symbol.for("paused");const _e=Symbol.for("balls");const Se=Symbol.for("settings");const Fe=Symbol.for("paused");const Ae=Symbol.for("loop");const Ie=Symbol.for("balls");const Re=Symbol.for("loop");const Ce=Symbol.for("paused");const $e=Symbol.for("settings");const Pe=Symbol.for("paused");const Ve=Symbol.for("balls");const He=Symbol.for("settings");const qe=Symbol.for("paused");const We=Symbol.for("balls");const Ue=Symbol.for("loop");class Animator{constructor(e,n={}){const s="string"==typeof e?document.getElementById(e):e;if(!s)throw new Error("Canvas element not supplied.");this.context=s.getContext("2d"),this.siteswap=null,this[Ue]=null,this[qe]=!1,this[We]=[],this[He]={dwell:.5,slowdown:1,reversed:!1,ballColor:"#ff3636",beatDuration:300,ballRadius:100,catchWidth:400,innerHeight:0,innerWidth:0,catchHeight:0,multiplier:null},this.configure(n)}}return Animator.prototype.start=function(e,n){if(this[Ae]&&this.stop(),"string"==typeof e&&(e=new de(e,n)),this.siteswap=e,!e.valid)throw new Error("Invalid siteswap.");if(2<e.degree)throw new Error(`Pattern requires ${e.degree} hands.`);if(0!==e.greatestValue){this[Se];M(this),this[Fe]=!1,this[Ae]=new he(e=>Z(this,e))}},Animator.prototype.stop=function(){const e=this[Re];e&&(L(this.context),e.kill(),this[Re]=null,this[Ie].length=0,this.siteswap=null)},Animator.prototype.pause=function(){this[Ce]=!this[Ce]},Animator.prototype.configure=function(e){const n=this[le];void 0!==e.beatDuration&&(n.beatDuration=e.beatDuration),void 0!==e.slowdown&&(n.slowdown=e.slowdown),void 0!==e.dwell&&(n.dwell=e.dwell),void 0!==e.ballColor&&(n.ballColor=e.ballColor),void 0!==e.reversed&&(n.reversed=e.reversed);const{beatDuration:s,dwell:t,slowdown:a,ballColor:o,reversed:r}=n;if("number"!=typeof s)throw new Error("Invalid configuration (`beatDuration` must be a number).");if(0>=s)throw new Error("Invalid configuration (`beatDuration` must be positive).");if("number"!=typeof a)throw new Error("Invalid configuration (`slowdown` must be a number).");if(0>=a)throw new Error("Invalid configuration (`slowdown` must be positive).");if("number"!=typeof t)throw new Error("Invalid configuration (`dwell` must be a number).");if(0>t||1<t)throw new Error("Invalid configuration (`dwell` must be in [0-1] range).");if("string"!=typeof o)throw new Error("Invalid configuration (`ballColor` must be a string).");if(!/^#[0-9a-f]{3}(?:[0-9a-f]{3})?/i.test(o))throw new Error("Invalid configuration (`ballColor` must be a valid css color).");if("boolean"!=typeof r)throw new Error("Invalid configuration (`reversed` must be a boolean).")},Animator.prototype.dye=function(e,n){const s=this[Ve];const t=this[$e];const a=this.context;if(void 0===n)for(const n of s)n.color=e;else{if(!s[n])throw new Error("Ball doesn't exist.");s[n].color=e}if(this[Pe]){L(a);for(const e of s)e.draw(a,t)}},Animator}();