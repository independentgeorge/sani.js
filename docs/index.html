<!DOCTYPE html>

<html>

   <head>

   <style>

      * {
         padding: 0;
         margin: 0;
         box-sizing: border-box;      
      }

      body {
         position: fixed;
         top: 10%;
         width: 100%;
         height: 75%;
         margin: 0 auto;
         background-color: #f5f5f5;
         font-family: Consolas, monospace;
      }

      main {
         position: relative;
         height: 100%;
         width: 33%;
         min-width: 200px;
         max-width: 750px;
         margin: 0 auto;
         text-align: center;
      }

      input {
         position: absolute;
         left: 0;
         width: 100%;
         height: 7.5%;
         border: none;
         outline: none;
         text-overflow: ellipsis;
         font-size: 30px;
         font-size: 5vh;
         font-family: "Courier New";
         font-weight: bold;
         color: #5a6160;
         background-color: #f5f5f5;
         z-index: 10;
      }

      canvas {
         position: absolute;
         top: 8.5%;
         left: 0;
         width: 100%;
         height: 91.5%;
         padding: 3%;
         background-color: white;
      }

      #error {
         position: absolute;
         top: 8.5%;
         width: 100%;
         height: 91.5%;
         display: none;
         justify-content: center;
         align-items: center;
         text-align: center;
         color: #d22828;
         font-size: 16px;
         font-size: 2.2vh;
         text-transform: uppercase;
      }
      #error.active {
         display: flex;
      }

      #random {
         position: absolute;
         top: 102.5%;
         left: 50%;
         transform: translateX(-50%);
         text-align: center;
         font-size: 12px;
         font-size: 2vh;
         color: #adadad;
         cursor: default;
      }
      #random:hover {
         border-bottom: 1px dotted #adadad;
         color: #999;
      }

   </style>

   <script src="https://cdn.rawgit.com/independentgeorge/sani.js/master/dist/sani.min.js"></script>

   </head>



   <body>


   <main>
      <input id="siteswap">
      <canvas id="canvas" class="error"></canvas>
      <p id="error"></p>
      <p id="random">show me more</p>
   </main>

   <script>

   "use strict"

   window.onload = function(){

      try{
         eval("(() => {})")
      }
      catch(e){
         document.body.innerHTML = '<div id="error" class="active">Seriously, man, IE?!</div>'
         throw new Error("Dead.")
      }


      const colors = ["#ff3636", "#31cc64", "#ae65ed", "#4888EF"]
      const siteswaps = [
         "3", "[33]", "60", "441", "531", "612", "711", "801", "8040", "51414", "63141", "81411", "521[43]0", "(4,2x)*", "(4,2x)(2x,4x)*", "(6,2x)(2x,2x)*",
         "4", "[44]", "53", "534", "615", "633", "714", "741", "7531", "63551", "64514", "63353", "[43]14", "(6x,4)(4,2x)*", "(8x,2x)(2x,4x)*", "(8,4)(4,2x)(2x,4)*",
         "5", "[55]", "64", "645", "861", "744", "753", "771", "88441", "97531", "96451", "[53]25", "7423[54]", "(6x,4)*", "(8,2x)*", "(6,6)(2x,6)*",
         "6", "75", "756", "774", "855", "864", "945", "963", "9753", "85845", "94458", "[65]25", "[87]4425", "(8x,6)(6,4x)*", "(8x,6)(4,6x)*",
         "7", "86", "867", "885", "948", "966", "975", "993", "9784", "99494", "99188", "8888881", "[86]25", "(8,6x)*", "(8x,6)*"
      ]


      const input    = document.getElementById("siteswap")
      const error    = document.getElementById("error")
      const button   = document.getElementById("random")
      const animator = new Animator("canvas")
      const siteswap = sessionStorage.getItem("siteswap") || random(siteswaps)
      input.addEventListener("focus", function(){ this.value = this.value })
      input.addEventListener("input", function(){ juggle() })
      button.addEventListener("click", function(){ juggle(random(siteswaps)) })
      document.addEventListener("keydown", function(e){ if( e.keyCode === 27 ) juggle("") });  // Escape button.

      juggle(siteswap)


      function juggle( siteswap ){

         if( siteswap === undefined ){
            siteswap = input.value
         }
         else if( siteswap !== input.value ){
            input.value = siteswap
            input.focus()
         }

         sessionStorage.setItem("siteswap", siteswap)

         animator.stop()

         if( siteswap.trim() === "" ){
            error.className = ""
            return
         }

         const validInput = /[0-9a-zA-Z,()[\]]/.test(siteswap)
         if( !validInput ){
            error.innerHTML = "Invalid siteswap"
            error.className = "active"
            return
         }

         try{
            animator.configure({ ballColor: random(colors) })
            animator.start(siteswap)
            error.className = ""
         }
         catch(e){
            error.innerHTML = e.message.replace(/\.$/, "")
            error.className = "active"
         }

      }

      function random( items ){

         return items[Math.floor(Math.random() * items.length)];

      }

   }

   </script>

   </body>

</html>