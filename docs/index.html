<!DOCTYPE html>

<html>

   <head>

   <style>

      * {
         padding: 0;
         margin: 0;
         box-sizing: border-box;      
      }
      body {
         width: 500px;
         margin: 0 auto;
         padding: 50px;
         box-sizing: content-box;
         background-color: #f5f5f5;
      }
      input,
      canvas {
         display: block;
         margin: 0 auto;
         width: 100%;
         border: 1px solid lightgray;
         background-color: white;
      }
      input {
         padding: 10px;
         font-size: 30px;
         color: #5a6160;
      }
      input:focus {
         outline: none;
      }
      canvas {
         height: 500px;
         padding: 10px;
         border-top: none;
      }
      #error {
         width: 100%;
         margin: 0 auto;
         line-height: 40px;
         position: absolute;
         left: 0;
         right: 0;
         text-align: center;
         font-size: 20px;
         display: none;
         color: #d80f00;
      }
      #error.active {
         display: block;
      }

   </style>

   <script src="https://cdn.rawgit.com/independentgeorge/sani.js/master/dist/sani.min.js"></script>

   </head>



   <body>

   <input id="input">
   <div id="error"></div>
   <canvas id="canvas" class="error"></canvas>

   <script>


   window.onload = function(){

      if( !sessionStorage ){
         document.body.innerHTML = '<div id="error" class="active">Seriously, man, IE?!</div>'
         throw new Error("Dead.")
      }

      const input = document.getElementById("input")
      const error = document.getElementById("error")
      const animator = new Animator("canvas")

      input.focus()
      input.value = sessionStorage.getItem("siteswap") || random("[33]", "5", "645", "753", "86411")
      input.addEventListener("input", juggle)
      juggle.call(input)


      function juggle(){

         sessionStorage.setItem("siteswap", this.value)

         animator.stop()

         if( this.value.trim() === "" ){
            error.className = ""
            return
         }

         const validInput = /[0-9a-zA-Z,()[\]]/.test(this.value)
         if( !validInput ){
            error.innerHTML = "Invalid siteswap"
            error.className = "active"
            return
         }

         try{
            animator.start(this.value)
            error.className = ""
         }
         catch(e){
            error.innerHTML = e.message.replace(/\.$/, "")
            error.className = "active"
         }

      }

      function random( arg1, arg2 /*, ... */ ){

         return arguments[Math.floor(Math.random() * arguments.length)];

      }

   }

   </script>

   </body>

</html>